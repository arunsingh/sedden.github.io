<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Pros and cons using Puppet's $::osfamily instead of $::operatingsystem Fact</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <!-- Favicon -->
        <link href="/favicon.png" rel="icon">

        <!-- OpenID -->
        <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
        <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/2cd92ecb-186e-42d2-839e-e1b36cc3d6fb">

        <!-- Feed -->
        <link type="application/atom+xml" rel="alternate" href="/atom.xml"/>

		<!-- Flattr -->
		<script type="text/javascript">
        /* <![CDATA[ */
		(function() {
			var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
			s.type = 'text/javascript';
			s.async = true;
			s.src = '//api.flattr.com/js/0.6/load.js?mode=auto&button=compact&uid=test&category=text';
			t.parentNode.insertBefore(s, t);
		})();
		/* ]]> */
		</script>

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">A developer's notebook</a></h1>
            <a class="extra" href="/">home</a>
            <a class="extra" href="/about/">about</a>
            <a class="extra" href="/atom.xml">feed</a>
          </div>

          <h2>Pros and cons using Puppet's $::osfamily instead of $::operatingsystem Fact</h2>
<p class="meta">27 Mar 2013</p>

<div class="post">
<p>Once you read the <a href="http://docs.puppetlabs.com/guides/style_guide.html">Puppet Style Guide</a>, you should know how to write well structured manifests, with the modest indentation, spacing, arrow alignment, quoting and so on.
Well, I think there are lots of other things you <del>better</del> should care. 
For this time, it&#39;s about when to use <code>$::osfamily</code> and when better to stay with the <code>$::operatingsystem</code> fact.</p>

<h4>Pros</h4>

<p>The key benefit of using <code>$::osfamily</code> is that you don&#39;t end up forking your favorite Puppet module on GitHub to add the eleventh RedHat derivate: </p>
<div class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="kr">case</span> <span class="nv">$::operatingsystem</span> <span class="p">{</span>
   <span class="s1">&#39;RedHat&#39;</span><span class="p">,</span> <span class="s1">&#39;CentOS&#39;</span><span class="p">,</span> <span class="s1">&#39;Scientific&#39;</span><span class="p">,</span> <span class="m">.</span> <span class="m">.</span> <span class="m">.</span> <span class="p">,</span> <span class="s1">&#39;OracleLinux&#39;</span><span class="p">,</span> <span class="s1">&#39;OEL&#39;</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # do something RHEL specific</span>
   }
   <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # do something Debian specific </span>
   }
   <span class="kr">default</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # ...</span>
   }
<span class="p">}</span>
</code></pre></div>
<p>Instead you would use:</p>
<div class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="kr">case</span> <span class="nv">$::osfamily</span> <span class="p">{</span>
   <span class="s1">&#39;redhat&#39;</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # do something RHEL specific</span>
   }
   <span class="s1">&#39;debian&#39;</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # do something Debian specific </span>
   }
   <span class="kr">default</span><span class="p">:</span> <span class="p">{</span><span class="c-Singleline"></span>
<span class="c-Singleline">     # ...</span>
   }
<span class="p">}</span>
</code></pre></div>
<p>It allows you to write cleaner manifests and works well for common tasks. 
You still have the choice to handle details via <code>$::operatingsystem</code> the more complex your classes become.</p>

<h4>Cons</h4>

<p>There are disadvantages of course: You claim tosupport an Operating-System you might haven&#39;t even heard of.
But my experience is that most people are using the EPEL repositories anyway. So wouldn&#39;t it be enough to test your modules against EPEL? And yes: you really should test your manifests!</p>

<h4>Support for Facter &lt; 1.6.1</h4>

<p>The <code>$::osfamily</code> fact was introduced with Facter 1.6.1. There is a simple workaround for older versions. I found this solution in the description of the <a href="https://github.com/puppetlabs/puppetlabs-mysql/">puppetlabs-mysql Module</a>. Just put this into your <code>site.pp</code> (before any node definition):</p>
<div class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="kr">if</span> <span class="o">!</span> <span class="nv">$::osfamily</span> <span class="p">{</span>
  <span class="kr">case</span> <span class="nv">$::operatingsystem</span> <span class="p">{</span>
    <span class="s1">&#39;RedHat&#39;</span><span class="p">,</span> <span class="s1">&#39;Fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;CentOS&#39;</span><span class="p">,</span> <span class="s1">&#39;Scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;SLC&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendos&#39;</span><span class="p">,</span> <span class="s1">&#39;CloudLinux&#39;</span><span class="p">,</span> <span class="s1">&#39;PSBM&#39;</span><span class="p">,</span> <span class="s1">&#39;OracleLinux&#39;</span><span class="p">,</span> <span class="s1">&#39;OVS&#39;</span><span class="p">,</span> <span class="s1">&#39;OEL&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">$osfamily</span> <span class="o">=</span> <span class="s1">&#39;RedHat&#39;</span>
    }
    <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">$osfamily</span> <span class="o">=</span> <span class="s1">&#39;Debian&#39;</span>
    }
    <span class="s1">&#39;SLES&#39;</span><span class="p">,</span> <span class="s1">&#39;SLED&#39;</span><span class="p">,</span> <span class="s1">&#39;OpenSuSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SuSE&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">$osfamily</span> <span class="o">=</span> <span class="s1">&#39;Suse&#39;</span>
    }
    <span class="s1">&#39;Solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;Nexenta&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">$osfamily</span> <span class="o">=</span> <span class="s1">&#39;Solaris&#39;</span>
    }
    <span class="kr">default</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">$osfamily</span> <span class="o">=</span> <span class="nv">$::operatingsystem</span>  
    }
  <span class="p">}</span>
}
</code></pre></div>
<p>It defines <code>$::osfamily</code> if not available.</p>

</div>

<div>
    <a class="FlattrButton" style="display:none;"
        title="Pros and cons using Puppet's $::osfamily instead of $::operatingsystem Fact"
        rel="flattr;uid:sedden;popout:0;category:text"
        href="http://jenkner.org/blog/2013/03/27/use-osfamily-instead-of-operatingsystem">
    </a>
</div>

<div>



	<p><a href="/blog/2013/03/26/openwrt-ipv6-forwarding">« Forwarding IPv6 Traffic from WAN to LAN with OpenWRT</a></p>



	<p><a href="/blog/2014/05/01/from-octopress-to-jekyll">Howto migrate from Octopress to Jekyll »</a></p>


</div>


          <div class="footer">
            <div class="contact">
              <p>
                Stefan Jenkner<br />
                stefan@jenkner.org
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/sedden">github.com/sedden</a><br />
                <a href="https://twitter.com/sedden">twitter.com/sedden</a> 
                <a href="https://alpha.app.net/sedden">alpha.app.net/sedden</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
